# -*- coding: utf-8 -*-
"""tamminimongodp.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1StTFnlJuLr177o5LSemfK2M8CNoX6e3j
"""



import streamlit as st
from pymongo import MongoClient
from datetime import datetime

# Set up MongoDB connection
client = MongoClient("mongodb+srv://tammeni25:MytamminiPass25!25@tammini.pcsh9ci.mongodb.net/?retryWrites=true&w=majority&appName=tammini")
db = client["tammini_db"]
users_col = db["users"]
responses_col = db["responses"]

st.set_page_config(page_title="Ù…Ù†ØµØ© Ø·ÙÙ…Ù‘Ù†ÙŠ", layout="centered", page_icon="ğŸ§ ")

# ------------------ Auth Functions ------------------

def signup():
    st.subheader("ğŸ” ØªØ³Ø¬ÙŠÙ„ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯")
    username = st.text_input("Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…")
    password = st.text_input("ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±", type="password")
    if st.button("ØªØ³Ø¬ÙŠÙ„"):
        if users_col.find_one({"username": username}):
            st.error("Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ø§Ù„ÙØ¹Ù„.")
        else:
            users_col.insert_one({"username": username, "password": password})
            st.success("ØªÙ… Ø§Ù„ØªØ³Ø¬ÙŠÙ„! ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¢Ù† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„.")

def login():
    st.subheader("ğŸ”‘ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„")
    username = st.text_input("Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…")
    password = st.text_input("ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±", type="password")
    if st.button("Ø¯Ø®ÙˆÙ„"):
        user = users_col.find_one({"username": username, "password": password})
        if user:
            st.session_state['user'] = username
            st.success("Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨ÙƒØŒ ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„.")
        else:
            st.error("Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„ ØºÙŠØ± ØµØ­ÙŠØ­Ø©.")

# ------------------ Questionnaire Form ------------------

def questionnaire():
    st.subheader("ğŸ“ Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù†ÙØ³ÙŠ")
    gender = st.radio("Ù…Ø§ Ù‡Ùˆ Ø¬Ù†Ø³ÙƒØŸ", ["Ø°ÙƒØ±", "Ø£Ù†Ø«Ù‰"])
    age = st.radio("Ù…Ø§ Ù‡ÙŠ ÙØ¦ØªÙƒ Ø§Ù„Ø¹Ù…Ø±ÙŠØ©ØŸ", ["18-29", "30-39", "40-49", "50+"])

    q1 = st.text_area("Ø³1: Ù‡Ù„ ØªØ¹Ø§Ù†ÙŠ Ù…Ù† Ø§Ù„ØªÙÙƒÙŠØ± Ø§Ù„Ù…ÙØ±Ø· Ø£Ùˆ Ø§Ù„Ù‚Ù„Ù‚ Ø§Ù„Ø²Ø§Ø¦Ø¯ØŸ")
    q2 = st.text_area("Ø³2: Ù‡Ù„ ØªØ¬Ø¯ ØµØ¹ÙˆØ¨Ø© ÙÙŠ Ø§Ù„Ø³ÙŠØ·Ø±Ø© Ø¹Ù„Ù‰ Ù‡Ø°Ù‡ Ø§Ù„Ø£ÙÙƒØ§Ø±ØŸ")
    q3 = st.text_area("Ø³3: Ù…Ø§ Ø§Ù„Ø£Ø¹Ø±Ø§Ø¶ Ø§Ù„ØªÙŠ ØªØ¹Ø§Ù†ÙŠ Ù…Ù†Ù‡Ø§ØŸ")
    q4 = st.text_area("Ø³4: Ù‡Ù„ Ù…Ø±Ø±Øª Ø¨ÙØªØ±Ø© Ù…Ø²Ø§Ø¬ Ù…ÙƒØªØ¦Ø¨ Ø£Ùˆ ÙÙ‚Ø¯Ø§Ù† Ø§Ù„Ø´ØºÙØŸ")
    q5 = st.text_area("Ø³5: Ù‡Ù„ Ø£Ø«Ø±Øª Ù‡Ø°Ù‡ Ø§Ù„Ø£Ø¹Ø±Ø§Ø¶ Ø¹Ù„Ù‰ Ø­ÙŠØ§ØªÙƒ Ø§Ù„ÙŠÙˆÙ…ÙŠØ©ØŸ")
    q6 = st.text_area("Ø³6: Ù‡Ù„ Ù‡Ø°Ù‡ Ø§Ù„Ø£Ø¹Ø±Ø§Ø¶ Ù„ÙŠØ³Øª Ø¨Ø³Ø¨Ø¨ Ø¯ÙˆØ§Ø¡ Ø£Ùˆ Ø­Ø§Ù„Ø© Ø¹Ø¶ÙˆÙŠØ©ØŸ")

    if st.button("Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…"):
        user = st.session_state.get('user')
        if user:
            responses_col.insert_one({
                "username": user,
                "gender": gender,
                "age": age,
                "q1": q1, "q2": q2, "q3": q3,
                "q4": q4, "q5": q5, "q6": q6,
                "timestamp": datetime.now()
            })
            st.success("âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª.")
        else:
            st.error("âš ï¸ ÙŠØ±Ø¬Ù‰ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹.")

# ------------------ UI Navigation ------------------

st.markdown("""
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    <style>
    html, body, .stApp {
        background-color: #e6f7ff;
        font-family: 'Cairo', sans-serif;
        direction: rtl;
    }
    .stButton>button {
        background-color: #66ccff;
        color: white;
        border-radius: 10px;
        font-size: 18px;
        padding: 10px 20px;
        border: none;
    }
    .stButton>button:hover {
        background-color: #4db8ff;
    }
    .stRadio>div {
        background-color: #f2fbff;
        padding: 10px;
        border-radius: 10px;
    }
    h1, h2, h3 {
        color: #005b99;
        text-align: center;
    }
    .title-container {
        background-color: #b3e0ff;
        padding: 30px;
        border-radius: 12px;
        margin-bottom: 30px;
    }
    </style>
    <div class='title-container'>
        <h1>Ø·ÙÙ…Ù‘Ù†ÙŠ</h1>
        <h3>Ù…Ù†ØµØ© ØªÙ‚ÙŠÙŠÙ… Ø§Ù„ØµØ­Ø© Ø§Ù„Ù†ÙØ³ÙŠØ© Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ</h3>
        <img src='https://cdn-icons-png.flaticon.com/512/4320/4320337.png' width='90'/>
    </div>
""", unsafe_allow_html=True)


if 'page' not in st.session_state:
    st.session_state.page = "landing"

if st.session_state.page == "landing":
   if st.button("ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ / Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨"):

        st.session_state.page = "auth"
    st.stop()

if 'user' not in st.session_state:
    page = st.radio("Ø§Ø®ØªØ± Ø§Ù„ØµÙØ­Ø©", ["ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„", "ØªØ³Ø¬ÙŠÙ„ Ø¬Ø¯ÙŠØ¯"], horizontal=True)
    if page == "ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„":
        login()
    else:
        signup()
    st.stop()
else:
    questionnaire()

